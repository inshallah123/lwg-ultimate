# 主题调色板系统需求文档

主题系统允许用户高度自定义组件样式，通过集成一个调色板UI，向用户暴露接口。
调色板可通过electron顶部菜单栏的"调色"唤出。

## 一、系统架构设计

### 当前实现状态
主题系统已按模块化设计实现，包含以下独立面板：
- **全局样式** (GlobalStylePanel)
- **年视图** (YearViewPanel)  
- **年视图-月份卡片** (MonthCardPanel)
- **月视图** (MonthViewPanel)
- **周视图** (WeekViewPanel)


## 二、各模块功能详述

### （一）全局样式
- 背景颜色设置
- 渐变背景（起始色、结束色、角度）
- 透明度调节
- 背景图片上传及自适应

### （二）年视图
- 容器样式（背景、渐变、透明度、圆角、阴影）
- 标题样式（字体大小、颜色、粗细）
- 背景图片设置

### （三）年视图-月份卡片
- 通用卡片样式（背景、渐变、透明度、边框）
- 字体样式（大小、颜色）
- 交互样式（悬浮背景）
- 今天所在月份样式（背景、边框）

### （四）月视图
- 容器样式（背景、渐变）
- 标题样式（大小、颜色）
- 星期标题样式
- 日期单元格样式（背景、悬浮、字体）
- 今天样式
- 农历样式（农历、节日、节气）

### （五）周视图
- 容器背景
- 周标题样式
- 日期行标题样式（非列）
- 今天标题样式
- 时间列样式
- 小时格子样式
- 农历样式

## 三、技术实现要点

### CSS Modules 兼容性问题及解决方案
**问题**：项目使用CSS Modules，类名会被编译成唯一哈希值（如`.yearContainer`变成`.YearView_yearContainer__abc123`）

**解决方案**：使用属性选择器匹配
```css
/* 错误方式 */
.yearContainer { background: red; }

/* 正确方式 */
[class*="yearContainer"] { background: red; }
```

### 样式优先级管理
1. 所有自定义样式需添加 `!important` 确保覆盖默认样式
2. 子元素可能遮挡父元素效果，需同时设置相关元素
3. 示例：月视图悬浮效果需同时设置多个元素背景透明

### 样式隔离策略
- 月视图样式需添加 `[class*="monthContainer"]` 前缀
- 周视图样式需添加 `[class*="weekContainer"]` 前缀
- 避免样式相互影响

## 四、已知限制

### 无法通过调色板控制的样式
1. **月视图动态涂灰区域**
   - 原因：基于滚动位置动态计算，属于功能性视觉提示
   - 涉及类：`.currentMonth` / `.otherMonth`
   - 建议：保持为固定样式

2. **布局相关样式**
   - CSS文件第二部分的布局样式不应暴露给用户
   - 包括：尺寸、间距、定位、显示方式等

## 五、调色板功能特性

### 已实现功能
1. ✅ 实时预览（点击预览按钮跳转到对应组件）
2. ✅ 撤销功能
3. ✅ 清空所有设置
4. ✅ 保存主题配置到本地
5. ✅ 主题命名和加载
6. ✅ 拖动调色板窗口

### 开发建议
1. 新增样式选项前，先确认对应的CSS类名和结构
2. 使用属性选择器而非直接类名选择器
3. 注意样式的继承关系和覆盖顺序
4. 测试不同视图间的样式隔离

## 六、文件组织结构

```
F:\coding\apps\littlewhitegoose\src\components\ThemePalette\
├── ThemePalette.tsx          # 主组件
├── ThemePalette.module.css   # 调色板UI样式
├── panels/                    # 各模块面板
│   ├── GlobalStylePanel.tsx
│   ├── YearViewPanel.tsx
│   ├── MonthCardPanel.tsx
│   ├── MonthViewPanel.tsx
│   ├── WeekViewPanel.tsx
│   └── Panel.module.css
├── utils/                     # 工具函数
│   ├── themeApplier.ts      # 样式应用逻辑
│   └── themeStorage.ts      # 主题存储
├── types.ts                  # 类型定义
├── RPD.md                    # 需求文档（本文件）
└── 需求-CSS代码对应表.md     # CSS映射关系表
```

## 七、版本更新记录

### 2025-08-27 更新
- 移除年份数字面板（功能冗余）
- 拆分月/周视图为独立面板
- 修复CSS Modules兼容性问题
- 优化选择器策略
- 完善文档说明